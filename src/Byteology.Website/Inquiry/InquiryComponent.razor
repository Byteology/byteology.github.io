@using Byteology.Website.Inquiry.Contacts

<div class="@(_successfulSubmit.HasValue ? "hidden" : (_shouldFadeIn ? "animate-fade-in-fast" : ""))">
    <div class="panel p-0 flex flex-col md:flex-row">
        <div class="basis-0 shrink-0 grow-[3]">
            <div class="panel-overlay"></div>
            <div class="p-8 space-y-4">
                <div>@CallToAction</div>
                @if (Contacts != null)
                {
                    @foreach (Contact contact in Contacts)
                    {
                        <ContactComponent Contact="@contact"/>
                    }
                }
            </div>
        </div>
        <div class="basis-0 shrink-0 grow-[4]">
            <div class="p-8 flex h-full items-center">
                <InquiryForm OnSubmit="onSubmit"/>
            </div>
        </div>
    </div>
</div>

<div class="panel @(_successfulSubmit.HasValue ? "animate-fade-in-fast" : "hidden")">
    <h1 class="text-lg lg:text-xl font-bold text-center uppercase
               @(_successfulSubmit == true ? "text-accent" : "") @(_successfulSubmit == false ? "text-error" : "")">
        @getLightboxTitle()
    </h1>

    <p>@getLightboxBody()</p>

    @if (_successfulSubmit == false)
    {
        <button type="button" class="button p-2 mt-4 w-full" @onclick=@(() => _successfulSubmit = null)>Continue</button>
    }
</div>

@code {

    private bool? _successfulSubmit;
    private bool _shouldFadeIn = false;

    [Parameter]
    public RenderFragment? CallToAction { get; set; }

    [Parameter]
    public Contact[]? Contacts { get; set; }

    private void onSubmit(InquiryForm.SubmissionEventArgs args)
    {
        _successfulSubmit = args.Success;
        _shouldFadeIn = true;
    }

    private string getLightboxTitle()
    {
        string? result = null;

        if (_successfulSubmit.HasValue)
            result = _successfulSubmit.Value ? "Thank you!" : "Oops!";

        return result ?? string.Empty;
    }

    private string getLightboxBody()
    {
        string? result = null;

        if (_successfulSubmit.HasValue)
            result = _successfulSubmit.Value ? "Thank you for reaching out! We'll make sure to help you the best we can. We usually answer within 2 business days." : "We are terribly sorry but something went wrong. You can either retry or just write us a plain old email.";

        return result ?? string.Empty;
    }

}
